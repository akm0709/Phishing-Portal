<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #f5f7fa 0%, #ffffff 100%);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      color: #333;
      position: relative;
      overflow-x: hidden;
      font-weight: 500;
      letter-spacing: 0.3px;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        radial-gradient(circle at 1px 1px, rgba(46, 125, 50, 0.03) 1px, transparent 1px);
      background-size: 50px 50px;
      pointer-events: none;
      z-index: -1;
    }

    body::after {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #f5f7fa 0%, #ffffff 100%);
      pointer-events: none;
      z-index: -2;
    }

    /* Floating Security Shapes Container */
    .bg-shapes {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
      overflow: hidden;
    }

    .floating-shape {
      position: absolute;
      opacity: 0.15;
      filter: drop-shadow(0 2px 4px rgba(46, 125, 50, 0.1));
    }

    .shape-1 {
      width: 120px;
      height: 120px;
      top: 10%;
      left: 5%;
      animation: float-shape-1 20s ease-in-out infinite;
    }

    .shape-2 {
      width: 100px;
      height: 100px;
      top: 20%;
      right: 10%;
      animation: float-shape-2 25s ease-in-out infinite;
    }

    .shape-3 {
      width: 80px;
      height: 80px;
      top: 50%;
      left: 15%;
      animation: float-shape-3 18s ease-in-out infinite;
    }

    .shape-4 {
      width: 110px;
      height: 110px;
      bottom: 15%;
      right: 8%;
      animation: float-shape-4 22s ease-in-out infinite;
    }

    .shape-5 {
      width: 90px;
      height: 90px;
      top: 60%;
      right: 25%;
      animation: float-shape-5 24s ease-in-out infinite;
    }

    .shape-6 {
      width: 70px;
      height: 70px;
      bottom: 30%;
      left: 50%;
      animation: float-shape-6 19s ease-in-out infinite;
    }

    .shape-7 {
      width: 95px;
      height: 95px;
      top: 30%;
      left: 60%;
      animation: float-shape-7 23s ease-in-out infinite;
    }

    .shape-8 {
      width: 85px;
      height: 85px;
      bottom: 10%;
      left: 30%;
      animation: float-shape-8 21s ease-in-out infinite;
    }

    @keyframes float-shape-1 {
      0%, 100% { transform: translateX(0px) translateY(0px) rotate(0deg); }
      25% { transform: translateX(30px) translateY(-30px) rotate(90deg); }
      50% { transform: translateX(0px) translateY(-60px) rotate(180deg); }
      75% { transform: translateX(-30px) translateY(-30px) rotate(270deg); }
    }

    @keyframes float-shape-2 {
      0%, 100% { transform: translateX(0px) translateY(0px) scale(1); }
      25% { transform: translateX(-40px) translateY(-40px) scale(1.1); }
      50% { transform: translateX(0px) translateY(-80px) scale(1); }
      75% { transform: translateX(40px) translateY(-40px) scale(1.1); }
    }

    @keyframes float-shape-3 {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      33% { transform: translateY(-50px) rotate(120deg); }
      66% { transform: translateY(-100px) rotate(240deg); }
    }

    @keyframes float-shape-4 {
      0%, 100% { transform: translateX(0px) translateY(0px); }
      50% { transform: translateX(-60px) translateY(-60px); }
    }

    @keyframes float-shape-5 {
      0%, 100% { transform: translateY(0px) scale(1); }
      50% { transform: translateY(-80px) scale(1.15); }
    }

    @keyframes float-shape-6 {
      0%, 100% { transform: translateX(0px) translateY(0px) rotate(0deg); }
      50% { transform: translateX(70px) translateY(-70px) rotate(180deg); }
    }

    @keyframes float-shape-7 {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      33% { transform: translateY(-40px) rotate(120deg); }
      66% { transform: translateY(-80px) rotate(240deg); }
    }

    @keyframes float-shape-8 {
      0%, 100% { transform: translateX(0px) translateY(0px) scale(1); }
      25% { transform: translateX(50px) translateY(-50px) scale(0.9); }
      50% { transform: translateX(0px) translateY(-100px) scale(1); }
      75% { transform: translateX(-50px) translateY(-50px) scale(0.9); }
    }

    @media (max-width: 768px) {
      .floating-shape {
        opacity: 0.08;
      }

      .shape-1 { width: 80px; height: 80px; }
      .shape-2 { width: 70px; height: 70px; }
      .shape-3 { width: 60px; height: 60px; }
      .shape-4 { width: 75px; height: 75px; }
      .shape-5 { width: 65px; height: 65px; }
      .shape-6 { width: 55px; height: 55px; }
      .shape-7 { width: 70px; height: 70px; }
      .shape-8 { width: 60px; height: 60px; }
    }

    .home-icon {
      position: fixed;
      top: 1.8rem;
      left: 2rem;
      width: 3.2rem;
      height: 3.2rem;
      background: linear-gradient(135deg, #2e7d32, #4caf50);
      color: #fff;
      border: 2px solid #fff;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.4rem;
      line-height: 1;
      cursor: pointer;
      transition: all 0.3s ease;
      z-index: 1001;
      text-decoration: none;
      box-shadow: 0 4px 15px rgba(46, 125, 50, 0.3);
    }

    .home-icon i {
      display: flex;
      align-items: center;
      justify-content: center;
      line-height: 1;
      margin-top: 0.15rem;
    }

    .home-icon:hover {
      background: #fff;
      color: #2e7d32;
      transform: scale(1.12) translateY(-2px);
      box-shadow: 0 6px 20px rgba(46, 125, 50, 0.4);
      border-color: #2e7d32;
    }

    .home-icon.disabled {
      background: #ccc;
      color: #888;
      border-color: #ccc;
      cursor: not-allowed;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .home-icon.disabled:hover {
      background: #ccc;
      color: #888;
      transform: none;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .login-container {
      max-width: 380px;
      margin: 0.4rem auto 1.5rem auto;
      background-color: #ffffff;
      padding: 1.2rem;
      border-radius: 8px;
      border: 2px solid #2e7d32;
      text-align: center;
      animation: fadeInUp 0.8s ease 0.3s both;
    }

    .login-container h1 {
      color: #2e7d32;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin-bottom: 1rem;
      font-weight: 800;
      font-size: 1.5rem;
      letter-spacing: -0.5px;
      animation: fadeInDown 0.8s ease 0.2s both;
    }

    .login-form input {
      width: 100%;
      padding: 0.7rem;
      margin-bottom: 0.8rem;
      border: 1px solid #2e7d32;
      border-radius: 6px;
      font-size: 0.95rem;
      font-weight: 500;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      color: #333;
      animation: fadeInUp 0.8s ease 0.4s both;
    }

    .login-form button {
      width: 100%;
      padding: 0.7rem;
      background: #2e7d32;
      color: #fff;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      transition: 0.3s ease;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      letter-spacing: 0.2px;
      margin-bottom: 0.4rem;
      animation: fadeInUp 0.8s ease 0.5s both;
    }

    .login-form button:hover {
      background: #1b4620;
    }

    .back-home-btn {
      width: 100%;
      padding: 0.6rem 1.5rem;
      background: rgba(255, 255, 255, 0.6);
      color: #2e7d32;
      border: 1px solid rgba(46, 125, 50, 0.3);
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin-top: 0.5rem;
      display: block;
      text-align: center;
      text-decoration: none;
      backdrop-filter: blur(10px);
      letter-spacing: 0.2px;
      animation: fadeInUp 0.8s ease 0.6s both;
    }

    .back-home-btn:hover {
      background: rgba(46, 125, 50, 0.1);
      border-color: #2e7d32;
      transform: translateY(-2px);
    }

    .login-container .copyright-footer {
      margin-top: 0.5rem;
      border-top: 1px solid #2e7d32;
      padding-top: 0.5rem;
      font-size: 0.85rem;
    }

    /* FDC Logo in Navbar */
    .fdc-logo-nav {
      position: fixed;
      top: 15px;
      right: 15px;
      left: auto;
      transform: none;
      width: 120px;
      height: 60px;
      z-index: 1001;
      opacity: 1;
      pointer-events: auto;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.3s ease;
      background: transparent;
      padding: 10px;
    }

    .fdc-logo-nav:hover {
      transform: scale(1.08);
    }

    .fdc-logo-svg {
      width: 100%;
      height: auto;
      max-width: 140px;
      filter: drop-shadow(0 3px 6px rgba(0, 0, 0, 0.15));
    }

    body {
      padding-top: 40px;
    }

    .dashboard {
      display: none;
      padding: 2rem;
      padding-top: 0.5rem;
      max-width: 1400px;
      margin: 0 auto;
    }

    .dashboard.active {
      display: block;
    }

    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid #2e7d32;
    }

    .dashboard-header h1 {
      color: #2e7d32;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      font-weight: 700;
      font-size: 2rem;
    }

    .logout-btn {
      background: transparent;
      color: #2e7d32;
      border: 2px solid #2e7d32;
      padding: 0.6rem 1.2rem;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 700;
      transition: 0.3s ease;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    .logout-btn:hover {
      background: #2e7d32;
      color: #fff;
    }

    .tabs {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      border-bottom: 2px solid #2e7d32;
    }

    .tab-btn {
      padding: 0.8rem 1.5rem;
      background: transparent;
      color: #2e7d32;
      border: none;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 700;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      transition: 0.3s ease;
    }

    .tab-btn.active {
      color: #2e7d32;
      border-bottom-color: #2e7d32;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .login-data-section h2,
    .question-management-section h2 {
      color: #2e7d32;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-weight: 700;
      margin-top: 2rem;
      margin-bottom: 1rem;
      font-size: 1.5rem;
    }

    .login-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
      border: 2px solid #2e7d32;
      border-radius: 8px;
      overflow: hidden;
    }

    .login-table thead {
      background: #2e7d32;
      color: #fff;
    }

    .login-table th {
      padding: 1rem;
      text-align: left;
      font-weight: 700;
    }

    .login-table td {
      padding: 0.8rem 1rem;
      border-bottom: 1px solid #e0e0e0;
    }

    .login-table tbody tr:hover {
      background: #f5f5f5;
    }

    .status-pass {
      background: #4caf50;
      color: #fff;
      padding: 0.4rem 0.8rem;
      border-radius: 4px;
      font-weight: 700;
      text-align: center;
      display: inline-block;
    }

    .status-fail {
      background: #c62828;
      color: #fff;
      padding: 0.4rem 0.8rem;
      border-radius: 4px;
      font-weight: 700;
      text-align: center;
      display: inline-block;
    }

    .question-form {
      background: #f9f9f9;
      padding: 2rem;
      border: 2px solid #2e7d32;
      border-radius: 8px;
      margin-bottom: 2rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      color: #2e7d32;
      font-weight: 700;
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 0.8rem;
      border: 1px solid #2e7d32;
      border-radius: 6px;
      font-size: 1rem;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.5;
    }

    .form-group textarea {
      resize: vertical;
      min-height: 80px;
    }

    .options-container {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .option-input {
      display: flex;
      gap: 0.8rem;
      align-items: center;
      padding: 0.8rem;
      background: #f9f9f9;
      border-radius: 6px;
      border: 1px solid #e0e0e0;
    }

    .option-input input[type="text"] {
      flex: 1;
      padding: 0.6rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    .option-input input[type="checkbox"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
      flex-shrink: 0;
    }

    .option-input label {
      margin: 0;
      font-weight: 500;
      color: #2e7d32;
      white-space: nowrap;
      flex-shrink: 0;
    }

    .button-group {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .btn {
      padding: 0.8rem 1.5rem;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
      cursor: pointer;
      font-weight: 700;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      transition: 0.3s ease;
    }

    .btn-primary {
      background: #2e7d32;
      color: #fff;
    }

    .btn-primary:hover {
      background: #1b4620;
    }

    .btn-secondary {
      background: transparent;
      color: #2e7d32;
      border: 2px solid #2e7d32;
    }

    .btn-secondary:hover {
      background: #2e7d32;
      color: #fff;
    }

    .btn-danger {
      background: #c62828;
      color: #fff;
    }

    .btn-danger:hover {
      background: #8b1c1c;
    }

    .btn-edit {
      background: #2196f3;
      color: #fff;
      padding: 0.4rem 0.8rem;
      font-size: 0.9rem;
    }

    .btn-edit:hover {
      background: #1565c0;
    }

    .question-list {
      display: grid;
      gap: 1.5rem;
    }

    .question-card {
      background: #f9f9f9;
      border: 2px solid #2e7d32;
      padding: 1.5rem;
      border-radius: 8px;
    }

    .question-card h3 {
      color: #2e7d32;
      margin-top: 0;
      font-weight: 700;
    }

    .question-card p {
      margin: 0.5rem 0;
    }

    .question-card-options {
      margin: 1rem 0;
      padding-left: 1rem;
      border-left: 3px solid #2e7d32;
    }

    .question-card-options li {
      margin: 0.5rem 0;
    }

    .image-preview {
      margin-top: 1rem;
      max-width: 100%;
      max-height: 300px;
      border-radius: 6px;
      border: 2px solid #2e7d32;
    }

    .image-upload-container {
      margin-top: 1rem;
    }

    .image-upload-input {
      padding: 0.8rem;
      border: 2px dashed #2e7d32;
      border-radius: 6px;
      background: #fafafa;
      cursor: pointer;
    }

    .image-preview-box {
      margin-top: 1rem;
      padding: 1rem;
      background: #f5f5f5;
      border: 1px solid #2e7d32;
      border-radius: 6px;
      text-align: center;
    }

    .image-preview-box img {
      max-width: 100%;
      max-height: 200px;
      border-radius: 4px;
      margin-top: 0.5rem;
    }

    .question-card-image {
      margin: 1rem 0;
      text-align: center;
    }

    .question-card-image img {
      max-width: 100%;
      max-height: 300px;
      border-radius: 6px;
      border: 1px solid #2e7d32;
    }

    .question-card-actions {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
    }

    .empty-state {
      text-align: center;
      padding: 2rem;
      color: #999;
      font-style: italic;
    }

    .success-message {
      background: #4caf50;
      color: #fff;
      padding: 1rem;
      border-radius: 6px;
      margin-bottom: 1rem;
      animation: slideDown 0.5s ease;
      max-width: 600px;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    .error-message {
      background: #c62828;
      color: #fff;
      padding: 1rem;
      border-radius: 6px;
      margin-bottom: 1rem;
      animation: slideDown 0.5s ease;
      max-width: 600px;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    @keyframes slideDown {
      from {
        transform: translateY(-20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .export-btn {
      background: #2e7d32;
      color: #fff;
      padding: 0.8rem 1.5rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 700;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin-bottom: 1rem;
    }

    .export-btn:hover {
      background: #1b4620;
    }

    /* Copyright Footer */
    .copyright-footer {
      text-align: center;
      font-size: 0.75rem;
      color: #2e7d32;
      font-weight: 600;
      padding: 1rem;
      border-top: 1px solid #2e7d32;
      margin-top: 1.5rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    @media (max-width: 768px) {
      .dashboard {
        padding: 1rem;
      }

      .options-container {
        flex-direction: column;
      }

      .login-table {
        font-size: 0.9rem;
      }

      .login-table th,
      .login-table td {
        padding: 0.6rem;
      }
    }
  </style>
</head>
<body>
  <!-- Floating Security Shapes Background -->
  <div class="bg-shapes">
    <!-- Lock Icon -->
    <svg class="floating-shape shape-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" color="#2e7d32">
      <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
      <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
    </svg>
    
    <!-- Shield Icon -->
    <svg class="floating-shape shape-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" color="#2e7d32">
      <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
    </svg>

    <!-- Hexagon Pattern -->
    <svg class="floating-shape shape-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" color="#2e7d32">
      <path d="M21 16.04c0 .537-.292 1.034-.761 1.3l-5.646 3.686a2.25 2.25 0 0 1-2.386 0L6.76 17.34A2.25 2.25 0 0 1 6 16.04V7.96c0-.537.292-1.034.761-1.3l5.646-3.686a2.25 2.25 0 0 1 2.386 0l5.646 3.686c.469.266.761.763.761 1.3v8.08z"></path>
    </svg>

    <!-- Lock Icon (Different shade) -->
    <svg class="floating-shape shape-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" color="#2e7d32">
      <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
      <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
    </svg>

    <!-- Shield Icon (Different shade) -->
    <svg class="floating-shape shape-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" color="#2e7d32">
      <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
    </svg>

    <!-- Hexagon Pattern (Different shade) -->
    <svg class="floating-shape shape-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" color="#2e7d32">
      <path d="M21 16.04c0 .537-.292 1.034-.761 1.3l-5.646 3.686a2.25 2.25 0 0 1-2.386 0L6.76 17.34A2.25 2.25 0 0 1 6 16.04V7.96c0-.537.292-1.034.761-1.3l5.646-3.686a2.25 2.25 0 0 1 2.386 0l5.646 3.686c.469.266.761.763.761 1.3v8.08z"></path>
    </svg>

    <!-- Lock Icon (Small) -->
    <svg class="floating-shape shape-7" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" color="#2e7d32">
      <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
      <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
    </svg>

    <!-- Shield Icon (Small) -->
    <svg class="floating-shape shape-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" color="#2e7d32">
      <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
    </svg>
  </div>

  <!-- FDC Logo in Navbar -->
  <a href="https://www.fdcindia.com/" target="_blank" class="fdc-logo-nav" title="Visit FDC India">
    <img src="favicon-green.svg" alt="FDC Logo" class="fdc-logo-svg" />
  </a>

  <a href="index.html" class="home-icon" title="Back to Home">
    <i class="fas fa-home"></i>
  </a>

  <!-- Login Screen -->
  <div class="login-container" id="loginScreen">
    <h1>Admin Login</h1>
    <form class="login-form" onsubmit="handleLogin(event)">
      <input type="text" id="username" placeholder="Username" required>
      <input type="password" id="password" placeholder="Password" required>
      <button type="submit">Login</button>
      <a href="index.html" class="back-home-btn">Back to Home</a>
    </form>
    <div class="copyright-footer">
      Copyright ¬© 2025 FDC | All Rights Reserved.
    </div>
  </div>

  <!-- Dashboard Screen -->
  <div class="dashboard" id="dashboard">
    <div class="dashboard-header">
      <h1>Administration Dashboard</h1>
      <button class="logout-btn" onclick="handleLogout()">Logout</button>
    </div>

    <div class="tabs">
      <button class="tab-btn active" onclick="switchTab('login-data')">Employee Login Data</button>
      <button class="tab-btn" onclick="switchTab('question-management')">Question Management</button>
    </div>

    <!-- Employee Login Data Tab -->
    <div id="login-data" class="tab-content active">
      <div class="login-data-section">
        <h2>Assessment Attempts Log</h2>
        <button class="export-btn" onclick="exportLoginData()">Export as CSV</button>
        <div id="messageContainer"></div>
        <table class="login-table">
          <thead>
            <tr>
              <th>Employee Name</th>
              <th>Employee ID</th>
              <th>Submission Time</th>
              <th>Score</th>
              <th>Percentage</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="loginTableBody">
            <tr>
              <td colspan="6" class="empty-state">No assessment data yet</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Question Management Tab -->
    <div id="question-management" class="tab-content">
      <div class="question-management-section">
        <h2>Add or Edit Question</h2>
        <form class="question-form" onsubmit="handleQuestionSubmit(event)">
          <div class="form-group">
            <label for="questionText">Question Text</label>
            <textarea id="questionText" placeholder="Enter the question" required></textarea>
          </div>

          <div class="form-group image-upload-container">
            <label for="questionImage">Question Image (Optional)</label>
            <input type="file" id="questionImage" accept="image/*" class="image-upload-input" onchange="previewImage()">
            <div class="image-preview-box" id="imagePreviewBox" style="display: none;">
              <p>Image Preview:</p>
              <img id="previewImg" src="" alt="Preview">
              <button type="button" class="btn btn-danger" onclick="clearImage()" style="margin-top: 0.5rem;">Clear Image</button>
            </div>
          </div>

          <div class="form-group">
            <label>Answer Options</label>
            <div class="options-container">
              <div class="option-input">
                <input type="text" id="option1" placeholder="Option 1" required>
                <input type="checkbox" name="correctAnswer" value="0">
                <label for="correctAnswer">Correct</label>
              </div>
              <div class="option-input">
                <input type="text" id="option2" placeholder="Option 2" required>
                <input type="checkbox" name="correctAnswer" value="1">
                <label for="correctAnswer">Correct</label>
              </div>
              <div class="option-input">
                <input type="text" id="option3" placeholder="Option 3" required>
                <input type="checkbox" name="correctAnswer" value="2">
                <label for="correctAnswer">Correct</label>
              </div>
              <div class="option-input">
                <input type="text" id="option4" placeholder="Option 4" required>
                <input type="checkbox" name="correctAnswer" value="3">
                <label for="correctAnswer">Correct</label>
              </div>
            </div>
          </div>

          <div class="button-group">
            <button type="submit" class="btn btn-primary">Add Question</button>
            <button type="reset" class="btn btn-secondary" onclick="resetQuestionForm()">Clear</button>
          </div>
        </form>

        <h2>All Questions</h2>
        <div id="bulkDeleteControls" style="display: none; margin-bottom: 1.5rem; padding: 1rem; background: #f5f5f5; border-radius: 8px; border-left: 4px solid #2e7d32;">
          <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
            <button class="btn btn-secondary" onclick="selectAllQuestions()" style="background: #2e7d32; color: #fff;">Select All</button>
            <button class="btn btn-secondary" onclick="deselectAllQuestions()" style="background: #999; color: #fff;">Deselect All</button>
            <span id="selectionCount" style="font-weight: 700; color: #2e7d32;">0 selected</span>
            <button class="btn btn-danger" onclick="bulkDeleteQuestions()" style="margin-left: auto;">Delete Selected</button>
            <button class="btn btn-secondary" onclick="exitSelectionMode()" style="background: #999; color: #fff;">Cancel</button>
          </div>
        </div>
        <div style="margin-bottom: 1rem;">
          <button class="btn btn-primary" onclick="enterSelectionMode()">Delete Multiple Questions</button>
        </div>
        <div id="questionsList" class="question-list">
          <div class="empty-state">No questions available</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Initialize admin system
    const ADMIN_USERNAME = 'admin';
    const ADMIN_PASSWORD = 'password';
    const DEFAULT_PASS_SCORE = 70; // Pass if 70% or higher
    
    // Global variables - declare at the top
    let DEFAULT_QUESTIONS = [];
    let currentViewMode = 'all'; // Always show all questions
    let selectionMode = false;
    let selectedQuestions = new Set();

    // Load data from localStorage (fallback)
    function loadLoginData() {
      const data = localStorage.getItem('quizAttempts');
      return data ? JSON.parse(data) : [];
    }

    // Fetch from Firebase - called after Firebase loads
    async function loadLoginDataFromFirebase() {
      if (window.fetchQuizAttemptsFromFirebase) {
        const attempts = await window.fetchQuizAttemptsFromFirebase();
        return attempts;
      }
      return loadLoginData(); // Fallback to localStorage
    }

    function loadCustomQuestions() {
      const data = localStorage.getItem('customQuestions');
      const questions = data ? JSON.parse(data) : [];
      console.log("üìÇ Loaded from localStorage:", questions.length, "custom questions");
      return questions;
    }

    function saveCustomQuestions(questions) {
      console.log("üíæ Saving", questions.length, "custom questions to localStorage");
      localStorage.setItem('customQuestions', JSON.stringify(questions));
      console.log("‚úÖ Saved to localStorage successfully");
      
      if (window.saveCustomQuestionsToFirebase) {
        console.log("üîó Syncing to Firebase...");
        window.saveCustomQuestionsToFirebase(questions).catch(err => {
          console.warn("‚ö†Ô∏è Firebase sync failed for custom questions:", err);
        });
      }
    }

    async function loadCustomQuestionsFromFirebase() {
      if (window.fetchCustomQuestionsFromFirebase) {
        try {
          return await window.fetchCustomQuestionsFromFirebase();
        } catch (err) {
          console.warn("Firebase fetch failed, using localStorage:", err);
          return loadCustomQuestions();
        }
      }
      return loadCustomQuestions();
    }

    // Authentication
    function handleLogin(event) {
      event.preventDefault();
      console.log("üîê Login attempted...");
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;

      if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
        console.log("‚úÖ Credentials valid!");
        sessionStorage.setItem('adminLoggedIn', 'true');
        console.log("‚úÖ Session storage set");
        
        const loginScreen = document.getElementById('loginScreen');
        const dashboard = document.getElementById('dashboard');
        
        console.log("üìÑ loginScreen element:", loginScreen !== null);
        console.log("üìÑ dashboard element:", dashboard !== null);
        
        if (loginScreen) {
          loginScreen.style.display = 'none';
          console.log("‚úÖ Login screen hidden");
        }
        if (dashboard) {
          dashboard.classList.add('active');
          console.log("‚úÖ Dashboard shown");
        }
        
        loadDashboardData();
        console.log("‚úÖ Dashboard data loaded");
      } else {
        console.log("‚ùå Invalid credentials");
        alert('Invalid credentials');
      }
    }

    function handleLogout() {
      sessionStorage.removeItem('adminLoggedIn');
      location.reload();
    }

    // Check if admin is logged in
    function checkAdminLogin() {
      console.log("üîç Checking admin login status...");
      const isLoggedIn = sessionStorage.getItem('adminLoggedIn');
      console.log("üìå Admin logged in:", isLoggedIn);
      
      const loginScreen = document.getElementById('loginScreen');
      const dashboard = document.getElementById('dashboard');
      
      if (!isLoggedIn) {
        console.log("‚ùå Not logged in - showing login screen");
        if (loginScreen) loginScreen.style.display = 'block';
        if (dashboard) dashboard.classList.remove('active');
      } else {
        console.log("‚úÖ Logged in - showing dashboard");
        if (loginScreen) loginScreen.style.display = 'none';
        if (dashboard) dashboard.classList.add('active');
        loadDashboardData();
      }
    }

    // Switch tabs
    function switchTab(tabName) {
      console.log("üìë Switching to tab:", tabName);
      // Hide all tabs
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
      });

      // Show selected tab
      const tabElement = document.getElementById(tabName);
      if (tabElement) {
        tabElement.classList.add('active');
        console.log("‚úÖ Tab", tabName, "shown");
      } else {
        console.error("‚ùå Tab element not found:", tabName);
      }
      
      if (event && event.target) {
        event.target.classList.add('active');
      }

      if (tabName === 'login-data') {
        loadLoginDataTable();
      } else if (tabName === 'question-management') {
        loadCustomQuestionsList();
      }
    }

    // Load login data table
    function loadLoginDataTable() {
      // Try Firebase first, fallback to localStorage
      if (window.fetchQuizAttemptsFromFirebase) {
        window.fetchQuizAttemptsFromFirebase().then(attempts => {
          displayLoginDataTable(attempts);
        }).catch(err => {
          console.warn("Firebase unavailable, using localStorage:", err);
          const attempts = loadLoginData();
          displayLoginDataTable(attempts);
        });
      } else {
        const attempts = loadLoginData();
        displayLoginDataTable(attempts);
      }
    }

    // Display the login data table
    function displayLoginDataTable(attempts) {
      const tbody = document.getElementById('loginTableBody');

      if (attempts.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" class="empty-state">No assessment data yet</td></tr>';
        return;
      }

      tbody.innerHTML = attempts.map((attempt, index) => {
        const date = new Date(attempt.timestamp);
        const formattedDate = date.toLocaleString();
        const percentage = Math.round((attempt.score / attempt.totalQuestions) * 100);
        const isPassed = percentage >= DEFAULT_PASS_SCORE;
        const statusClass = isPassed ? 'status-pass' : 'status-fail';
        const statusText = isPassed ? 'PASS' : 'FAIL';

        return `
          <tr>
            <td><span style="cursor: pointer; color: #2e7d32; font-weight: 700;" onclick="viewEmployeeReview(${index})">${attempt.employeeName}</span></td>
            <td>${attempt.employeeId}</td>
            <td>${formattedDate}</td>
            <td>${attempt.score}/${attempt.totalQuestions}</td>
            <td>${percentage}%</td>
            <td><span class="${statusClass}">${statusText}</span></td>
            <td><button class="btn btn-sm" onclick="viewEmployeeReview(${index})" style="background: #2196f3; color: #fff; padding: 0.4rem 0.8rem; border: none; border-radius: 4px; cursor: pointer; font-weight: 700;">View</button></td>
          </tr>
        `;
      }).join('');
    }

    // Export login data to CSV
    function exportLoginData() {
      const attempts = loadLoginData();
      if (attempts.length === 0) {
        alert('No data to export');
        return;
      }

      let csv = 'Employee Name,Employee ID,Submission Time,Score,Percentage,Status\n';
      attempts.forEach(attempt => {
        const date = new Date(attempt.timestamp).toLocaleString();
        const percentage = Math.round((attempt.score / attempt.totalQuestions) * 100);
        const status = percentage >= DEFAULT_PASS_SCORE ? 'PASS' : 'FAIL';
        csv += `"${attempt.employeeName}","${attempt.employeeId}","${date}","${attempt.score}/${attempt.totalQuestions}","${percentage}%","${status}"\n`;
      });

      const blob = new Blob([csv], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `quiz-attempts-${new Date().toISOString().split('T')[0]}.csv`;
      link.click();
    }

    // Question Management

    // Load default questions from localStorage (if admin modified them)
    function loadDefaultQuestionsFromStorage() {
      const stored = localStorage.getItem('defaultQuestions');
      if (stored) {
        return JSON.parse(stored);
      }
      return DEFAULT_QUESTIONS;
    }

    // Save default questions to localStorage
    function saveDefaultQuestionsToStorage(questions) {
      localStorage.setItem('defaultQuestions', JSON.stringify(questions));
      if (window.saveDefaultQuestionsToFirebase) {
        window.saveDefaultQuestionsToFirebase(questions).catch(err => {
          console.warn("Firebase sync failed for default questions:", err);
        });
      }
    }

    // Initialize DEFAULT_QUESTIONS from storage if available
    DEFAULT_QUESTIONS = loadDefaultQuestionsFromStorage();

    function enterSelectionMode() {
      selectionMode = true;
      selectedQuestions.clear();
      document.getElementById('bulkDeleteControls').style.display = 'block';
      loadCustomQuestionsList();
    }

    function exitSelectionMode() {
      selectionMode = false;
      selectedQuestions.clear();
      document.getElementById('bulkDeleteControls').style.display = 'none';
      updateSelectionCount();
      loadCustomQuestionsList();
    }

    function toggleQuestionSelection(questionId) {
      if (selectedQuestions.has(questionId)) {
        selectedQuestions.delete(questionId);
      } else {
        selectedQuestions.add(questionId);
      }
      updateSelectionCount();
    }

    function updateSelectionCount() {
      const count = selectedQuestions.size;
      document.getElementById('selectionCount').textContent = count + ' selected';
    }

    function selectAllQuestions() {
      const questionsList = document.getElementById('questionsList');
      const checkboxes = questionsList.querySelectorAll('input[type="checkbox"][data-question-id]');
      checkboxes.forEach(checkbox => {
        const questionId = checkbox.getAttribute('data-question-id');
        selectedQuestions.add(questionId);
        checkbox.checked = true;
      });
      updateSelectionCount();
    }

    function deselectAllQuestions() {
      const questionsList = document.getElementById('questionsList');
      const checkboxes = questionsList.querySelectorAll('input[type="checkbox"][data-question-id]');
      checkboxes.forEach(checkbox => {
        checkbox.checked = false;
      });
      selectedQuestions.clear();
      updateSelectionCount();
    }

    function bulkDeleteQuestions() {
      if (selectedQuestions.size === 0) {
        alert('Please select at least one question to delete');
        return;
      }

      const count = selectedQuestions.size;
      const message = count === 1 ? 'Delete 1 question?' : `Delete ${count} questions?`;
      
      if (!confirm(message)) return;

      console.log("üóëÔ∏è Starting bulk delete. Selected questions:", Array.from(selectedQuestions));

      selectedQuestions.forEach(questionId => {
        console.log("üóëÔ∏è Deleting question ID:", questionId);
        const isDefault = questionId.toString().startsWith('default_');
        console.log("üìå Is Default?", isDefault);
        
        if (isDefault) {
          console.log("üìö Before delete - DEFAULT_QUESTIONS count:", DEFAULT_QUESTIONS.length);
          console.log("üìö DEFAULT_QUESTIONS:", DEFAULT_QUESTIONS.map(q => q.id));
          const index = DEFAULT_QUESTIONS.findIndex(q => q.id === questionId || q.id.toString() === questionId.toString());
          console.log("üîç Found index:", index);
          if (index > -1) {
            DEFAULT_QUESTIONS.splice(index, 1);
            console.log("‚úÖ Deleted from array. New count:", DEFAULT_QUESTIONS.length);
            saveDefaultQuestionsToStorage(DEFAULT_QUESTIONS);
            console.log("üíæ Saved to storage");
          }
        } else {
          let questions = loadCustomQuestions();
          console.log("üìã Before delete - Custom questions count:", questions.length);
          console.log("üîé Looking for ID:", questionId, "in questions:", questions.map(q => ({ id: q.id, type: typeof q.id })));
          questions = questions.filter(q => q.id != questionId && q.id.toString() !== questionId.toString());
          console.log("üìã After delete - Custom questions count:", questions.length);
          saveCustomQuestions(questions);
        }
      });

      const message2 = count === 1 ? '1 question deleted successfully!' : `${count} questions deleted successfully!`;
      showMessage(message2, 'success');
      
      // Reload DEFAULT_QUESTIONS from storage to ensure display has latest data
      DEFAULT_QUESTIONS = loadDefaultQuestionsFromStorage();
      console.log("üîÑ Reloaded DEFAULT_QUESTIONS from storage:", DEFAULT_QUESTIONS.length);
      
      // Reload and display updated questions list
      const customQuestions = loadCustomQuestions();
      console.log("üîÑ Reloaded custom questions from storage:", customQuestions.length);
      console.log("üéØ About to display. Total will be:", DEFAULT_QUESTIONS.length + customQuestions.length);
      displayCustomQuestionsList(customQuestions);
      
      // Exit selection mode manually (without calling loadCustomQuestionsList which would override display)
      selectionMode = false;
      selectedQuestions.clear();
      document.getElementById('bulkDeleteControls').style.display = 'none';
      updateSelectionCount();
    }

    function handleQuestionSubmit(event) {
      event.preventDefault();

      const imageData = document.getElementById('previewImg').src || null;
      
      // Get all checked correct answers
      const correctAnswers = [];
      document.querySelectorAll('input[name="correctAnswer"]:checked').forEach(checkbox => {
        correctAnswers.push(parseInt(checkbox.value));
      });

      if (correctAnswers.length === 0) {
        alert('Please select at least one correct answer!');
        return;
      }

      const question = {
        id: Date.now(),
        q: document.getElementById('questionText').value,
        image: imageData,
        options: [
          document.getElementById('option1').value,
          document.getElementById('option2').value,
          document.getElementById('option3').value,
          document.getElementById('option4').value
        ],
        answer: correctAnswers.length === 1 ? correctAnswers[0] : correctAnswers,
        isDefault: false
      };

      let customQuestions = loadCustomQuestions();
      customQuestions.push(question);
      saveCustomQuestions(customQuestions);
      
      console.log("‚úÖ Question saved:", question);
      console.log("üìä Total custom questions now:", customQuestions.length);

      showMessage('Question added successfully!', 'success');
      resetQuestionForm();
      
      // Display immediately from localStorage without waiting for Firebase
      displayCustomQuestionsList(customQuestions);
    }

    function resetQuestionForm() {
      document.querySelector('.question-form').reset();
      clearImage();
    }

    function previewImage() {
      const fileInput = document.getElementById('questionImage');
      const previewBox = document.getElementById('imagePreviewBox');
      const previewImg = document.getElementById('previewImg');

      if (fileInput.files && fileInput.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
          previewImg.src = e.target.result;
          previewBox.style.display = 'block';
        };
        reader.readAsDataURL(fileInput.files[0]);
      }
    }

    function clearImage() {
      document.getElementById('questionImage').value = '';
      document.getElementById('imagePreviewBox').style.display = 'none';
      document.getElementById('previewImg').src = '';
    }

    function loadCustomQuestionsList() {
      console.log("üîÑ Loading custom questions list...");
      
      // If Firebase module is available, try to fetch from Firebase
      if (window.fetchCustomQuestionsFromFirebase) {
        console.log("üîó Firebase available, attempting to load from Firebase...");
        loadCustomQuestionsFromFirebase().then(questions => {
          console.log("‚úÖ Loaded custom questions from Firebase:", questions.length);
          displayCustomQuestionsList(questions);
        }).catch(err => {
          console.warn("‚ö†Ô∏è Firebase load failed, falling back to localStorage:", err);
          const questions = loadCustomQuestions();
          console.log("üìÅ Loaded custom questions from localStorage:", questions.length);
          displayCustomQuestionsList(questions);
        });
      } else {
        // Firebase not available yet, load from localStorage directly
        console.log("‚è≥ Firebase module not yet loaded, using localStorage");
        const questions = loadCustomQuestions();
        console.log("üìÅ Loaded custom questions from localStorage:", questions.length);
        displayCustomQuestionsList(questions);
      }
    }

    function displayCustomQuestionsList(questions) {
      const container = document.getElementById('questionsList');
      console.log("üéØ displayCustomQuestionsList called with:", questions.length, "custom questions");
      console.log("üìö DEFAULT_QUESTIONS available:", DEFAULT_QUESTIONS.length);
      
      if (!container) {
        console.error("‚ùå Container element 'questionsList' not found!");
        return;
      }
      
      // Always combine default and custom questions
      const displayQuestions = [...DEFAULT_QUESTIONS, ...questions];
      console.log("‚úÖ Total questions to display:", displayQuestions.length);

      if (displayQuestions.length === 0) {
        container.innerHTML = `<div class="empty-state">No questions available</div>`;
        return;
      }

      container.innerHTML = displayQuestions.map((q, index) => {
        const correctAnswerText = Array.isArray(q.answer) 
          ? q.answer.map(a => q.options[a]).join(', ')
          : q.options[q.answer];
        const isDefault = q.isDefault || q.id.toString().startsWith('default_');
        const isSelected = selectedQuestions.has(q.id);

        return `
        <div class="question-card" style="${isDefault ? 'border-left: 5px solid #ff9800; background: #fffbf0;' : ''} ${isSelected ? 'border: 3px solid #2e7d32; background: #e8f5e9;' : ''}">
          <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
            ${selectionMode ? `<input type="checkbox" data-question-id="${q.id}" ${isSelected ? 'checked' : ''} onchange="toggleQuestionSelection('${q.id}')" style="width: 20px; height: 20px; cursor: pointer; margin-right: 0.8rem; flex-shrink: 0; margin-top: 0.2rem;">` : ''}
            <h3 style="flex: 1; margin: 0;">Q${index + 1}: ${q.q}</h3>
            ${isDefault ? '<span style="background: #ff9800; color: #fff; padding: 0.3rem 0.8rem; border-radius: 4px; font-size: 0.85rem; font-weight: 600; white-space: nowrap; margin-left: 1rem;">DEFAULT</span>' : '<span style="background: #2e7d32; color: #fff; padding: 0.3rem 0.8rem; border-radius: 4px; font-size: 0.85rem; font-weight: 600; white-space: nowrap; margin-left: 1rem;">CUSTOM</span>'}
          </div>
          ${q.image ? `<div class="question-card-image"><img src="${q.image}" alt="Question Image"></div>` : ''}
          <div class="question-card-options">
            <strong>Options:</strong>
            <ul>
              ${q.options.map((opt, idx) => {
                const isCorrect = Array.isArray(q.answer) ? q.answer.includes(idx) : idx === q.answer;
                return `<li>${opt}${isCorrect ? ' <strong style="color: #4caf50;">(‚úì Correct Answer)</strong>' : ''}</li>`;
              }).join('')}
            </ul>
          </div>
          ${!selectionMode ? `<div class="question-card-actions">
            ${isDefault ? `
              <button class="btn btn-edit" onclick="editQuestion('${q.id}')">Edit</button>
            ` : `
              <button class="btn btn-edit" onclick="editQuestion(${q.id})">Edit</button>
            `}
          </div>` : ''}
        </div>
      `}).join('');
      
      console.log("üìù HTML rendered with", displayQuestions.length, "questions");
      console.log("üé® Container element found:", container !== null);
    }

    function deleteQuestion(questionId) {
      // Bulk delete is now the primary method - this function kept for backward compatibility
    }

    function editQuestion(questionId) {
      const isDefault = questionId.toString().startsWith('default_');
      let question;

      if (isDefault) {
        question = DEFAULT_QUESTIONS.find(q => q.id === questionId);
      } else {
        const questions = loadCustomQuestions();
        question = questions.find(q => q.id === questionId);
      }

      if (!question) return;

      // Populate form with question data
      document.getElementById('questionText').value = question.q;
      document.getElementById('option1').value = question.options[0];
      document.getElementById('option2').value = question.options[1];
      document.getElementById('option3').value = question.options[2];
      document.getElementById('option4').value = question.options[3];
      
      // Handle multiple correct answers
      const correctAnswers = Array.isArray(question.answer) ? question.answer : [question.answer];
      // Clear all checkboxes first
      document.querySelectorAll('input[name="correctAnswer"]').forEach(cb => cb.checked = false);
      // Check the correct ones
      correctAnswers.forEach(ans => {
        document.querySelector(`input[name="correctAnswer"][value="${ans}"]`).checked = true;
      });

      // Load image if exists
      if (question.image) {
        document.getElementById('previewImg').src = question.image;
        document.getElementById('imagePreviewBox').style.display = 'block';
      } else {
        clearImage();
      }

      // Change button text
      const submitBtn = document.querySelector('.question-form button[type="submit"]');
      const originalText = submitBtn.textContent;
      submitBtn.textContent = 'Update Question';

      // Store original form handler and replace with update handler
      const form = document.querySelector('.question-form');
      const originalOnsubmit = form.onsubmit;

      form.onsubmit = (e) => {
        e.preventDefault();
        const imageData = document.getElementById('previewImg').src || null;
        
        // Get all checked correct answers
        const newCorrectAnswers = [];
        document.querySelectorAll('input[name="correctAnswer"]:checked').forEach(checkbox => {
          newCorrectAnswers.push(parseInt(checkbox.value));
        });

        if (newCorrectAnswers.length === 0) {
          alert('Please select at least one correct answer!');
          return;
        }

        const updatedQuestion = {
          id: questionId,
          q: document.getElementById('questionText').value,
          image: imageData,
          options: [
            document.getElementById('option1').value,
            document.getElementById('option2').value,
            document.getElementById('option3').value,
            document.getElementById('option4').value
          ],
          answer: newCorrectAnswers.length === 1 ? newCorrectAnswers[0] : newCorrectAnswers,
          isDefault: isDefault
        };

        if (isDefault) {
          const index = DEFAULT_QUESTIONS.findIndex(q => q.id === questionId);
          if (index > -1) {
            DEFAULT_QUESTIONS[index] = updatedQuestion;
            // Save to localStorage to persist changes for users
            saveDefaultQuestionsToStorage(DEFAULT_QUESTIONS);
          }
          showMessage('Default question updated successfully!', 'success');
        } else {
          let allQuestions = loadCustomQuestions();
          const index = allQuestions.findIndex(q => q.id === questionId);
          allQuestions[index] = updatedQuestion;
          saveCustomQuestions(allQuestions);
          showMessage('Custom question updated successfully!', 'success');
        }

        resetQuestionForm();
        submitBtn.textContent = originalText;
        form.onsubmit = originalOnsubmit;
        loadCustomQuestionsList();
      };

      // Scroll to form
      document.querySelector('.question-form').scrollIntoView({ behavior: 'smooth' });
    }

    function showMessage(text, type) {
      const container = document.getElementById('messageContainer');
      const messageClass = type === 'success' ? 'success-message' : 'error-message';
      const message = document.createElement('div');
      message.className = messageClass;
      message.textContent = text;
      container.innerHTML = '';
      container.appendChild(message);

      setTimeout(() => {
        message.remove();
      }, 3000);
    }

    // Load dashboard
    function loadDashboardData() {
      console.log("üìä Loading dashboard data...");
      loadLoginDataTable();
      console.log("‚úÖ Login data table loaded");
      loadCustomQuestionsList();
      console.log("‚úÖ Custom questions list loaded");
    }

    function viewEmployeeReview(attemptIndex) {
      // Try Firebase first, fallback to localStorage
      if (window.fetchQuizAttemptsFromFirebase) {
        window.fetchQuizAttemptsFromFirebase().then(attempts => {
          displayEmployeeReview(attempts, attemptIndex);
        }).catch(err => {
          console.warn("Firebase error, using localStorage:", err);
          const attempts = loadLoginData();
          displayEmployeeReview(attempts, attemptIndex);
        });
      } else {
        const attempts = loadLoginData();
        displayEmployeeReview(attempts, attemptIndex);
      }
    }

    function displayEmployeeReview(attempts, attemptIndex) {
      const attempt = attempts[attemptIndex];
      
      if (!attempt) {
        alert('Review data not available for this attempt.');
        return;
      }

      // Parse userAnswers if it's stored as JSON string (from Firebase)
      let userAnswers = attempt.userAnswers;
      if (attempt.userAnswersJSON && typeof attempt.userAnswersJSON === 'string') {
        try {
          userAnswers = JSON.parse(attempt.userAnswersJSON);
        } catch (e) {
          console.error("Error parsing userAnswersJSON:", e);
          userAnswers = attempt.userAnswers || [];
        }
      }

      // For Firebase data (without full questions), use localStorage as fallback for full question details
      let questions = attempt.questions;
      if (!questions || questions.length === 0) {
        const localAttempts = loadLoginData();
        if (localAttempts[attemptIndex] && localAttempts[attemptIndex].questions) {
          questions = localAttempts[attemptIndex].questions;
        } else {
          alert('Full question data not available. Showing summary only.');
          questions = [];
        }
      }

      if (!userAnswers) {
        alert('Review data not available for this attempt.');
        return;
      }

      let html = `
        <div style="max-width: 1000px; max-height: 80vh; overflow-y: auto; background: #fff; padding: 2rem; border-radius: 8px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid #2e7d32;">
            <div>
              <h2 style="margin: 0; color: #2e7d32; font-size: 1.3rem;">Quiz Review - ${attempt.employeeName}</h2>
              <p style="margin: 0.5rem 0 0 0; color: #666; font-size: 0.9rem;">Employee ID: ${attempt.employeeId} | Date: ${new Date(attempt.timestamp).toLocaleString()}</p>
            </div>
            <button onclick="closeEmployeeReview()" style="background: #2e7d32; color: #fff; border: none; padding: 0.6rem 1.2rem; border-radius: 6px; cursor: pointer; font-weight: 700;">Close</button>
          </div>

          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 2rem; padding: 1rem; background: #f5f5f5; border-radius: 6px;">
            <div>
              <div style="color: #666; font-size: 0.9rem;">Score</div>
              <div style="font-size: 1.8rem; font-weight: 700; color: #2e7d32;">${attempt.score}/${attempt.totalQuestions}</div>
            </div>
            <div>
              <div style="color: #666; font-size: 0.9rem;">Percentage</div>
              <div style="font-size: 1.8rem; font-weight: 700; color: #2e7d32;">${Math.round((attempt.score / attempt.totalQuestions) * 100)}%</div>
            </div>
          </div>

          <div style="margin-top: 2rem;">
      `;

      userAnswers.forEach((userAnswer, qIndex) => {
        if (!questions[qIndex]) {
          console.warn("Question not found for index:", qIndex);
          return;
        }
        
        const question = questions[qIndex];
        const correctAnswer = question.answer;
        
        // Determine if answer is correct
        let isCorrect = false;
        if (Array.isArray(correctAnswer)) {
          if (Array.isArray(userAnswer)) {
            isCorrect = userAnswer.length === correctAnswer.length && 
                       userAnswer.every(a => correctAnswer.includes(a)) &&
                       correctAnswer.every(c => userAnswer.includes(c));
          } else if (userAnswer !== null) {
            isCorrect = correctAnswer.includes(userAnswer);
          }
        } else {
          if (Array.isArray(userAnswer)) {
            isCorrect = userAnswer.includes(correctAnswer);
          } else {
            isCorrect = userAnswer === correctAnswer;
          }
        }

        const statusColor = isCorrect ? '#4caf50' : userAnswer === null ? '#999' : '#f44336';
        const statusBadge = isCorrect ? '‚úì Correct' : userAnswer === null ? 'Not Attempted' : '‚úó Incorrect';

        html += `
          <div style="background: #f9f9f9; border-left: 4px solid ${statusColor}; padding: 1.2rem; margin-bottom: 1rem; border-radius: 6px;">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
              <div style="font-weight: 700; color: #2e7d32; font-size: 1rem;">Q${qIndex + 1}: ${question.q}</div>
              <div style="background: ${statusColor}; color: #fff; padding: 0.4rem 0.8rem; border-radius: 4px; font-weight: 700; font-size: 0.85rem;">${statusBadge}</div>
            </div>
        `;

        if (question.image && question.image.trim()) {
          html += `<img src="${question.image}" alt="Question Image" style="width: 100%; max-height: 120px; object-fit: contain; border-radius: 4px; margin-bottom: 1rem;">`;
        }

        html += `<div style="background: #fff; border: 1px solid #e0e0e0; border-radius: 4px; padding: 1rem;">`;

        question.options.forEach((option, optIndex) => {
          const isCorrectOption = Array.isArray(correctAnswer) ? correctAnswer.includes(optIndex) : optIndex === correctAnswer;
          const isUserSelected = Array.isArray(userAnswer) ? userAnswer.includes(optIndex) : optIndex === userAnswer;
          
          let optStyle = '';
          let icon = '';
          
          if (isCorrectOption && isUserSelected) {
            optStyle = 'background: #e8f5e9; border-left: 3px solid #4caf50;';
            icon = '<i class="fas fa-check-circle" style="color: #4caf50; margin-right: 0.5rem;"></i>';
          } else if (isCorrectOption) {
            optStyle = 'background: #e8f5e9; border-left: 3px solid #4caf50;';
            icon = '<i class="fas fa-check-circle" style="color: #4caf50; margin-right: 0.5rem;"></i>';
          } else if (isUserSelected && !isCorrect) {
            optStyle = 'background: #ffebee; border-left: 3px solid #f44336;';
            icon = '<i class="fas fa-times-circle" style="color: #f44336; margin-right: 0.5rem;"></i>';
          }

          let label = '';
          if (isCorrectOption && isUserSelected) {
            label = '<span style="color: #4caf50; font-weight: 700; margin-left: auto;">(Your Answer - Correct)</span>';
          } else if (isCorrectOption) {
            label = '<span style="color: #4caf50; font-weight: 700; margin-left: auto;">(Correct Answer)</span>';
          } else if (isUserSelected && !isCorrect) {
            label = '<span style="color: #f44336; font-weight: 700; margin-left: auto;">(Your Answer)</span>';
          }

          html += `
            <div style="padding: 0.8rem; margin-bottom: 0.5rem; border-radius: 4px; display: flex; align-items: center; ${optStyle}">
              ${icon}
              <span>${option}</span>
              ${label}
            </div>
          `;
        });

        html += `</div>`;

        if (userAnswer === null) {
          html += `
            <div style="background: #fff3e0; border-left: 4px solid #ff9800; padding: 0.8rem; margin-top: 1rem; border-radius: 4px;">
              <strong style="color: #ff9800;">Not Attempted</strong> - Employee did not select an answer for this question.
            </div>
          `;
        } else if (isCorrect) {
          html += `
            <div style="background: #e8f5e9; border-left: 4px solid #4caf50; padding: 0.8rem; margin-top: 1rem; border-radius: 4px;">
              <strong style="color: #4caf50;">Correct!</strong> Employee's answer matched the correct answer.
            </div>
          `;
        } else {
          const correctAnswerText = Array.isArray(correctAnswer) ? 
            correctAnswer.map(idx => question.options[idx]).join(' or ') : 
            question.options[correctAnswer];
          html += `
            <div style="background: #ffebee; border-left: 4px solid #f44336; padding: 0.8rem; margin-top: 1rem; border-radius: 4px;">
              <strong style="color: #f44336;">Incorrect</strong><br>
              Employee's answer: <strong>${Array.isArray(userAnswer) ? userAnswer.map(idx => question.options[idx]).join(', ') : question.options[userAnswer]}</strong><br>
              Correct answer: <strong>${correctAnswerText}</strong>
            </div>
          `;
        }

        html += `</div>`;
      });

      html += `
          </div>
        </div>
      `;

      const modal = document.getElementById('reviewModal') || createReviewModal();
      modal.innerHTML = html;
      modal.style.display = 'flex';
    }

    function createReviewModal() {
      const modal = document.createElement('div');
      modal.id = 'reviewModal';
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2000;
        padding: 2rem;
      `;
      document.body.appendChild(modal);
      return modal;
    }

    function closeEmployeeReview() {
      const modal = document.getElementById('reviewModal');
      if (modal) {
        modal.style.display = 'none';
      }
    }

    // Initialize on page load
    window.addEventListener('load', checkAdminLogin);
  </script>

  <!-- Firebase Module Script -->
  <script type="module">
    import { db, getDocs, collection, query, orderBy, saveCustomQuestionsToFirebase, fetchCustomQuestionsFromFirebase } from './firebase.js';

    // Fetch quiz attempts from Firebase
    window.fetchQuizAttemptsFromFirebase = async function() {
      try {
        console.log("üìñ Fetching quiz attempts from Firebase...");
        
        const q = query(collection(db, "quizAttempts"), orderBy("timestamp", "desc"));
        const querySnapshot = await getDocs(q);
        
        const attempts = [];
        querySnapshot.forEach((doc) => {
          attempts.push({
            id: doc.id,
            ...doc.data()
          });
        });

        console.log("‚úÖ Fetched", attempts.length, "quiz attempt(s) from Firebase");
        if (attempts.length === 0) {
          console.warn("‚ö†Ô∏è No quiz attempts found in Firebase. Ensure employees have submitted quizzes.");
        }
        return attempts;
      } catch (error) {
        console.error("‚ùå Error fetching from Firebase:", error);
        console.error("Error message:", error.message);
        console.error("Error code:", error.code);
        throw error;
      }
    };

    // Export custom questions functions to window
    window.saveCustomQuestionsToFirebase = saveCustomQuestionsToFirebase;
    window.fetchCustomQuestionsFromFirebase = fetchCustomQuestionsFromFirebase;

    // Test function to read all data from Firestore
    window.readTestDataFromFirebase = async function() {
      try {
        console.log("üìñ Reading test data from Firebase...");
        
        const querySnapshot = await getDocs(collection(db, "portalConfig"));
        
        if (querySnapshot.empty) {
          console.warn("‚ö†Ô∏è No documents found in portalConfig collection");
          alert("‚ö†Ô∏è No data found. Write test data from index.html first!");
          return;
        }

        console.log("‚úÖ Documents found:");
        querySnapshot.forEach((doc) => {
          console.log("üìÑ Document ID:", doc.id);
          console.log("üìã Data:", doc.data());
        });

        alert(`‚úÖ Found ${querySnapshot.size} document(s)! Check console for details.`);
      } catch (error) {
        console.error("‚ùå Error reading data from Firebase:", error);
        alert("‚ùå Error reading data. Check console for details.");
      }
    };

    // Auto-call on page load to test connection
    console.log("üî• Firebase module loaded on admin.html");
    console.log("üí° Quiz attempts will auto-load from Firebase when you view the Dashboard tab");
    
    // Test the connection immediately
    window.fetchQuizAttemptsFromFirebase().then(attempts => {
      console.log("üéâ Firebase connection successful! Found", attempts.length, "attempts.");
    }).catch(err => {
      console.error("‚ö†Ô∏è Firebase connection issue. Check your config and Firestore permissions.");
    });
  </script>

</body>
</html>
