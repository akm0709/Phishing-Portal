<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Phishing Awareness Quiz</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      background: #ffffff;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      color: #222;
      overflow-x: hidden;
    }

    .home-icon {
      position: fixed;
      top: 1.5rem;
      left: 1.5rem;
      width: 3rem;
      height: 3rem;
      background: #2e7d32;
      color: #fff;
      border: 2px solid #2e7d32;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.3rem;
      cursor: pointer;
      transition: all 0.3s ease;
      z-index: 1000;
      text-decoration: none;
      box-shadow: 0 2px 8px rgba(46, 125, 50, 0.2);
    }

    .home-icon:hover {
      background: #fff;
      color: #2e7d32;
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(46, 125, 50, 0.3);
    }

    canvas#matrix {
      display: none;
    }

    .quiz-container {
      max-width: 900px;
      margin: 4rem auto;
      background-color: #ffffff;
      padding: 2rem;
      border-radius: 8px;
      border: 2px solid #2e7d32;
      box-shadow: 0 4px 12px rgba(46, 125, 50, 0.1);
      animation: fadeIn 1s ease;
      z-index: 1;
    }

    h1 {
      text-align: center;
      color: #2e7d32;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin-bottom: 2rem;
      text-shadow: none;
      font-weight: 700;
      font-size: 2rem;
    }

    h2 {
      color: #2e7d32;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-weight: 600;
      font-size: 1.1rem;
    }

    .options label {
      display: block;
      background: #ffffff;
      border: 1px solid #2e7d32;
      padding: 1rem;
      margin-bottom: 0.5rem;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
      color: #222;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 1rem;
      line-height: 1.5;
    }

    .options label:hover {
      background: #2e7d32;
      color: #fff;
      transform: translateX(4px);
      border-color: #2e7d32;
    }

    .result {
      text-align: center;
      font-size: 1.5rem;
      margin-top: 2rem;
      color: #2e7d32;
      text-shadow: none;
      font-weight: 600;
    }

    .timer-section {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid #2e7d32;
    }

    .progress-info {
      font-size: 1rem;
      color: #222;
      font-weight: 500;
    }

    .timer {
      font-size: 1.5rem;
      font-weight: 600;
      color: #2e7d32;
      font-family: 'Fira Code', monospace;
      padding: 0.5rem 1rem;
      border: 2px solid #2e7d32;
      border-radius: 6px;
      min-width: 80px;
      text-align: center;
    }

    .timer.warning {
      color: #ff9800;
      border-color: #ff9800;
    }

    .timer.danger {
      color: #c62828;
      border-color: #c62828;
    }

    .buttons-group {
      display: flex;
      gap: 1rem;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      margin-top: 2rem;
    }

    .nav-exit-group {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      align-items: center;
      margin-top: 2rem;
    }

    .nav-btn, .clear-btn, .submit-btn {
      padding: 0.8rem 1.5rem;
      font-size: 1rem;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      white-space: nowrap;
    }

    .nav-btn {
      background: #2e7d32;
      color: #fff;
    }

    .nav-btn:hover:not(:disabled) {
      background: #1b4620;
      transform: translateY(-2px);
      box-shadow: 0 2px 8px rgba(46, 125, 50, 0.2);
    }

    .nav-btn:disabled {
      background: #ccc;
      color: #888;
      cursor: not-allowed;
    }

    .clear-btn {
      background: transparent;
      color: #2e7d32;
      border: 2px solid #2e7d32;
    }

    .clear-btn:hover {
      background: #2e7d32;
      color: #fff;
      transform: translateY(-2px);
    }

    .submit-btn {
      background: #2e7d32;
      color: #fff;
    }

    .submit-btn:hover {
      background: #1b4620;
      transform: translateY(-2px);
      box-shadow: 0 2px 8px rgba(46, 125, 50, 0.2);
    }

    .back-btn {
      display: block;
      background: transparent;
      color: #2e7d32;
      border: 2px solid #2e7d32;
      padding: 0.8rem 1.5rem;
      border-radius: 6px;
      font-size: 1rem;
      cursor: pointer;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .back-btn:hover {
      background: #2e7d32;
      color: #fff;
      transform: translateY(-2px);
    }

    .exit-quiz-btn {
      width: 100%;
      max-width: 200px;
    }

    .hidden {
      display: none;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideUp {
      from { transform: translateY(40px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
  </style>
</head>
<body>
  <a href="index.html" class="home-icon" title="Back to Home">
    <i class="fas fa-home"></i>
  </a>
  
  <canvas id="matrix"></canvas>

  <div class="quiz-container" id="employeeForm">
    <h1>Employee Information</h1>
    <form onsubmit="startQuiz(event)" id="empForm">
      <div style="margin-bottom: 1rem;">
        <label style="display: block; margin-bottom: 0.5rem; color: #2e7d32; font-weight: 600;">Employee Name</label>
        <input type="text" id="employeeName" placeholder="Enter your full name" required style="width: 100%; padding: 0.8rem; border: 1px solid #2e7d32; border-radius: 6px; font-size: 1rem;">
      </div>
      <div style="margin-bottom: 1.5rem;">
        <label style="display: block; margin-bottom: 0.5rem; color: #2e7d32; font-weight: 600;">Employee ID</label>
        <input type="text" id="employeeId" placeholder="Enter your employee ID" required style="width: 100%; padding: 0.8rem; border: 1px solid #2e7d32; border-radius: 6px; font-size: 1rem;">
      </div>
      <button type="submit" class="submit-btn" style="width: 100%;">Start Quiz</button>
      <button type="button" class="back-btn" onclick="goBack()" style="width: 100%; margin-top: 0.5rem;">Back to Home</button>
    </form>
  </div>

  <div class="quiz-container" id="quizContainer" style="display: none;">
    <h1>Phishing Awareness Quiz</h1>
    
    <div class="timer-section">
      <div class="progress-info">
        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">10</span>
      </div>
      <div class="timer" id="timer">60</div>
    </div>

    <form id="quizForm">
      <div id="questionContainer"></div>
    </form>

    <div class="buttons-group">
      <button class="nav-btn" id="prevBtn" onclick="previousQuestion()" type="button">Previous</button>
      <button class="clear-btn" id="clearBtn" onclick="clearOption()" type="button">Clear Option</button>
      <button class="nav-btn" id="nextBtn" onclick="nextQuestion()" type="button">Next</button>
    </div>

    <div class="nav-exit-group">
      <button class="submit-btn" id="submitBtn" onclick="submitQuiz()" style="display: none;" type="button">Submit Quiz</button>
      <button class="back-btn exit-quiz-btn" onclick="exitQuiz()" type="button">Exit Quiz</button>
    </div>
    <div class="result" id="result"></div>
  </div>

  <!-- Matrix animation removed -->

  <script>
    const questions = [
      {
        q: "You receive an email from your bank asking to confirm your login info via a link. What do you do?",
        options: [
          "Click the link and enter info",
          "Ignore it",
          "Contact bank using official site",
          "Forward it to a friend"
        ],
        answer: 2
      },
      {
        q: "Which of these is a common sign of a phishing attempt?",
        options: [
          "Personalized greeting",
          "Unusual sender address",
          "Secure https link",
          "Familiar company logo"
        ],
        answer: 1
      },
      {
        q: "What is the safest way to verify a suspicious link?",
        options: [
          "Click it and see",
          "Check hover preview",
          "Ask in comments",
          "Guess based on URL"
        ],
        answer: 1
      },
      {
        q: "You get a message saying you won a prize and need to pay a fee to claim it. What's the best action?",
        options: [
          "Pay quickly",
          "Reply with details",
          "Ignore or report it",
          "Try it for fun"
        ],
        answer: 2
      },
      {
        q: "Which of the following is NOT recommended to prevent phishing?",
        options: [
          "Use multi-factor authentication",
          "Ignore security updates",
          "Verify URLs",
          "Check email sender"
        ],
        answer: 1
      },
      {
        q: "Why is it risky to reuse the same password?",
        options: [
          "Slower typing",
          "Harder to remember",
          "One breach = all accounts compromised",
          "Sites require changes"
        ],
        answer: 2
      },
      {
        q: "What should you do if you clicked a phishing link by mistake?",
        options: [
          "Nothing, it's fine",
          "Tell friends",
          "Change passwords, scan device",
          "Buy antivirus"
        ],
        answer: 2
      },
      {
        q: "An email urges urgent action and threatens account closure. You should:",
        options: [
          "Panic and act",
          "Click fast",
          "Verify via official contact",
          "Reply to email"
        ],
        answer: 2
      },
      {
        q: "Which type of file is MOST likely to carry phishing malware?",
        options: [
          ".jpg",
          ".docx",
          ".mp3",
          ".txt"
        ],
        answer: 1
      },
      {
        q: "What's the best defense against phishing?",
        options: [
          "Being skeptical and aware",
          "Fast clicking",
          "Trusting everyone",
          "Avoiding the internet"
        ],
        answer: 0
      }
    ];

    let currentQuestionIndex = 0;
    let userAnswers = new Array(questions.length).fill(null);
    let timerInterval;
    let timeRemaining = 60;
    let employeeName = '';
    let employeeId = '';

    const questionContainer = document.getElementById("questionContainer");
    const currentQuestionSpan = document.getElementById("currentQuestion");
    const totalQuestionsSpan = document.getElementById("totalQuestions");
    const timerDisplay = document.getElementById("timer");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const submitBtn = document.getElementById("submitBtn");
    const clearBtn = document.getElementById("clearBtn");
    const result = document.getElementById("result");

    totalQuestionsSpan.textContent = questions.length;

    // Load custom questions and merge with default
    function loadAllQuestions() {
      const customQuestions = localStorage.getItem('customQuestions');
      if (customQuestions) {
        const custom = JSON.parse(customQuestions);
        questions.push(...custom);
        userAnswers = new Array(questions.length).fill(null);
        totalQuestionsSpan.textContent = questions.length;
      }
    }

    function startQuiz(event) {
      event.preventDefault();
      employeeName = document.getElementById('employeeName').value;
      employeeId = document.getElementById('employeeId').value;
      
      document.getElementById('employeeForm').style.display = 'none';
      document.getElementById('quizContainer').style.display = 'block';
      
      loadAllQuestions();
      displayQuestion();
    }

    function exitQuiz() {
      if (confirm('Are you sure you want to exit? Your answers will not be saved.')) {
        document.getElementById('employeeForm').style.display = 'block';
        document.getElementById('quizContainer').style.display = 'none';
        document.getElementById('empForm').reset();
        currentQuestionIndex = 0;
        userAnswers = new Array(questions.length).fill(null);
        clearInterval(timerInterval);
      }
    }

    function displayQuestion() {
      const question = questions[currentQuestionIndex];
      currentQuestionSpan.textContent = currentQuestionIndex + 1;
      
      questionContainer.innerHTML = `
        <div class="question">
          <h2>Q${currentQuestionIndex + 1}: ${question.q}</h2>
          ${question.image && question.image.trim() ? `<img src="${question.image}" alt="Question Image" style="max-width: 100%; max-height: 300px; border-radius: 6px; margin: 1rem 0; border: 2px solid #2e7d32;">` : ''}
          <div class="options">
            ${question.options.map((opt, j) => `
              <label>
                <input type="radio" name="currentQuestion" value="${j}" ${userAnswers[currentQuestionIndex] === j ? 'checked' : ''} /> ${opt}
              </label>
            `).join('')}
          </div>
        </div>
      `;

      updateButtonStates();
      resetTimer();
      startTimer();
    }

    function updateButtonStates() {
      prevBtn.disabled = currentQuestionIndex === 0;
      nextBtn.style.display = currentQuestionIndex === questions.length - 1 ? 'none' : 'block';
      submitBtn.style.display = currentQuestionIndex === questions.length - 1 ? 'block' : 'none';
    }

    function saveCurrentAnswer() {
      const selectedOption = document.querySelector('input[name="currentQuestion"]:checked');
      if (selectedOption) {
        userAnswers[currentQuestionIndex] = parseInt(selectedOption.value);
      } else {
        userAnswers[currentQuestionIndex] = null;
      }
    }

    function nextQuestion() {
      saveCurrentAnswer();
      if (currentQuestionIndex < questions.length - 1) {
        currentQuestionIndex++;
        displayQuestion();
      }
    }

    function previousQuestion() {
      saveCurrentAnswer();
      if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        displayQuestion();
      }
    }

    function clearOption() {
      const radioButtons = document.querySelectorAll('input[name="currentQuestion"]');
      radioButtons.forEach(radio => radio.checked = false);
      userAnswers[currentQuestionIndex] = null;
    }

    function resetTimer() {
      timeRemaining = 60;
      timerDisplay.textContent = "60";
      timerDisplay.classList.remove('warning', 'danger');
    }

    function startTimer() {
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        timeRemaining--;
        timerDisplay.textContent = timeRemaining;

        if (timeRemaining <= 20 && timeRemaining > 10) {
          timerDisplay.classList.add('warning');
          timerDisplay.classList.remove('danger');
        } else if (timeRemaining <= 10) {
          timerDisplay.classList.add('danger');
          timerDisplay.classList.remove('warning');
        }

        if (timeRemaining === 0) {
          clearInterval(timerInterval);
          // Only show alert and move to next if quiz container is still visible
          const quizContainer = document.getElementById('quizContainer');
          if (quizContainer && quizContainer.style.display !== 'none' && currentQuestionIndex < questions.length - 1) {
            alert("Time's up for this question! Moving to next question.");
            nextQuestion();
          }
        }
      }, 1000);
    }

    function submitQuiz() {
      saveCurrentAnswer();
      clearInterval(timerInterval);
      
      let score = 0;
      userAnswers.forEach((answer, index) => {
        if (answer === questions[index].answer) {
          score++;
        }
      });

      // Save attempt to localStorage
      const attempt = {
        employeeName: employeeName,
        employeeId: employeeId,
        timestamp: new Date().toISOString(),
        score: score,
        totalQuestions: questions.length
      };

      let attempts = JSON.parse(localStorage.getItem('quizAttempts') || '[]');
      attempts.push(attempt);
      localStorage.setItem('quizAttempts', JSON.stringify(attempts));

      const percentage = Math.round((score / questions.length) * 100);
      const isPassed = percentage >= 70;
      const statusText = isPassed ? 'PASSED' : 'FAILED';
      const statusColor = isPassed ? '#4caf50' : '#c62828';

      result.innerHTML = `
        <strong>Quiz Complete!</strong><br>
        Employee: ${employeeName}<br>
        You scored <strong>${score}</strong> out of <strong>${questions.length}</strong> (${percentage}%)<br>
        <span style="color: ${statusColor}; font-weight: 600;">Status: ${statusText}</span><br><br>
        <button class="nav-btn" onclick="location.reload()" type="button">Retake Quiz</button>
      `;
      questionContainer.innerHTML = '';
      document.querySelector('.buttons-group').style.display = 'none';
      submitBtn.style.display = 'none';
    }

    function exitQuiz() {
      if (confirm('Are you sure you want to exit? Your answers will not be saved.')) {
        clearInterval(timerInterval);
        window.location.href = "index.html";
      }
    }

    function goBack() {
      clearInterval(timerInterval);
      window.location.href = "index.html";
    }

    // Initialize
    displayQuestion();
  </script>
</body>
</html>
